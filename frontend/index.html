<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Perfume — Sales Assistant</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="./perfume.css" />
</head>
<body>
  <main class="perfume-app">
    <!-- Title -->
    <div class="avatar-title">Perfume Sales Assistant: <span id="aname">—</span></div>

    <!-- Avatar Stage -->
    <section class="avatar-stage">
      <!-- Static placeholder (shown when not live or after Stop) -->
      <div id="avatarPlaceholder" class="avatar-placeholder">
        <div class="avatar-placeholder-inner">
          <div class="avatar-badge">Avatar</div>
          <div class="avatar-hint">Press “Start” to begin</div>
        </div>
      </div>

      <!-- Live Video (hidden when not active) -->
      <video id="avatarVideo" class="avatar-video" autoplay playsinline muted></video>

      <!-- Live Audio (unmuted when gate is enabled) -->
      <audio id="avatarAudio" class="avatar-audio" autoplay></audio>

      <!-- Status -->
      <div id="viewerStatus" class="viewer-status">…</div>
    </section>

    <!-- Controls -->
    <section class="controls">
      <div class="ctrl-row">
        <label>Avatar:</label>
        <select id="avatarId">
          <option value="June_HR_public">June_HR_public</option>
          <option value="Amber_Orator_public">Amber_Orator_public</option>
        </select>
        <label>Voice:</label>
        <select id="voiceId">
          <option value="68dedac41a9f46a6a4271a95c733823c">Default</option>
        </select>
        <label>Pose:</label>
        <select id="poseName">
          <option>June HR</option>
          <option>Stand</option>
        </select>
      </div>

      <div class="ctrl-row">
        <button id="startBtn">Start</button>
        <button id="stopBtn" disabled>Stop</button>
        <button id="enableBtn" class="gate" disabled>Enable Audio</button>
        <button id="disableBtn" class="gate" disabled>Disable Audio</button>
      </div>

      <div class="ctrl-row">
        <textarea id="promptTxt" placeholder="Type a prompt to speak…"></textarea>
        <button id="speakBtn" disabled>Speak</button>
      </div>
    </section>

    <!-- Mic / Transcription (auto-hidden if backend lacks Whisper) -->
    <section id="micBlock" class="mic-block" style="display:none">
      <div class="debug-head">
        <div>Microphone & Transcription</div>
        <div class="mic-right">
          <select id="micDevice"></select>
          <button id="micStartBtn">Start Mic</button>
          <button id="micStopBtn" disabled>Stop Mic</button>
        </div>
      </div>
      <div class="mic-row">
        <label class="mic-label">Live Transcript:</label>
        <textarea id="micTranscript" spellcheck="false" readonly></textarea>
      </div>
    </section>

    <!-- Debug Console -->
    <section class="debug">
      <div class="debug-head">
        <div>Debug Console</div>
        <button id="clearLogBtn" type="button">Clear</button>
      </div>
      <textarea id="debugLog" spellcheck="false" readonly></textarea>
    </section>
  </main>

  <!-- Runtime API base (local vs production) -->
  <script>
    (function(){
      const params = new URLSearchParams(location.search);
      const override = params.get("api");
      if (override) { window.API_BASE = override; return; }

      const isLocal = location.protocol === "file:" ||
                      location.hostname === "localhost" ||
                      location.hostname.startsWith("127.");
      if (!window.API_BASE || typeof window.API_BASE !== "string" || !window.API_BASE.trim()) {
        window.API_BASE = isLocal
          ? "http://localhost:8000"
          : location.origin; // same-origin in Render/production
      }
    })();
  </script>

  <script src="./perfume.js"></script>

  <!-- Optional auto-start (comment out to require manual Start) -->
  <script>
    // window.addEventListener("load", () => {
    //   if (typeof window.__startSession === "function") window.__startSession();
    // });
  </script>
</body>
</html>
