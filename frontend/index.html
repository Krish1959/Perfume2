<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Perfume2 ‚Äî Local HTML + FastAPI</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="./perfume.css" />
</head>
<body>
  <main class="perfume-app">
    <!-- Title -->
    <div class="avatar-title">Perfume Sales Assistant: <span id="aname">‚Äî</span></div>

    <!-- Avatar Stage -->
    <section class="avatar-stage">
      <img id="avatarPlaceholder"
           src="https://files2.heygen.ai/avatar/v3/74447a27859a456c955e01f21ef18216_45620/preview_talk_1.webp"
           alt="Avatar preview" />
      <video id="avatarVideo" playsinline muted></video>
      <audio id="avatarAudio"></audio>
      <div id="audioGate" class="avatar-overlay">
        <button id="enableBtn" type="button">üîä Tap to enable sound</button>
      </div>
    </section>

    <!-- Status line -->
    <div id="viewerStatus" class="status-bar">Ready.</div>

    <!-- Input + Controls -->
    <section class="controls-wrap">
      <textarea id="editBox" class="transcribe-box" placeholder="Message‚Ä¶">Hello, who are you?</textarea>

      <div class="controls-row" id="controlsRow">
        <button id="btn-mic" class="mic-button" title="Start/End Recording">üéôÔ∏è Rec</button>
        <button id="btn-send-avatar" title="Send to Avatar">üí¨ Avt</button>
        <button id="btn-instruction"  title="Instruction">Ins</button>
        <button id="btn-chatgpt"      title="Send to ChatGPT">GPT</button>
        <button id="btn-start"        title="Start Session">‚ñ∂ SS</button>
        <button id="btn-stop"         title="End Session">‚èπ ES</button>
      </div>
    </section>

    <!-- Perfume tiles -->
    <h3 style="margin:24px 4px 10px">Perfume Collection <small style="opacity:.7">‚Äì Click (EN) / Double-click (‰∏≠Êñá)</small></h3>
    <section id="perfumeGrid" class="perfume-gallery one-row">
      <figure class="perfume-item" data-say="Endless mountains & rivers.">
        <img src="./assets/1_Endless_rivers.png" alt="Endless Mountains & Rivers" />
        <figcaption>Endless Mountains & Rivers</figcaption>
      </figure>

      <figure class="perfume-item" data-say="Flowing gently into calm.">
        <img src="./assets/2_Flowing_Calm.png" alt="Flowing Gently Into Calm" />
        <figcaption>Flowing Gently Into Calm</figcaption>
      </figure>

      <figure class="perfume-item" data-say="Stillness in the mountains. Quiet strength.">
        <img src="./assets/3_Still_Mountain.png" alt="Stillness in the Mountains" />
        <figcaption>Stillness in the Mountains</figcaption>
      </figure>

      <figure class="perfume-item" data-say="Wind through wooden frames.">
        <img src="./assets/4_Wind_Frames.png" alt="Wind Through Wooden Frames" />
        <figcaption>Wind Through Wooden Frames</figcaption>
      </figure>

      <figure class="perfume-item" data-say="Rain in the hills.">
        <img src="./assets/5_Rain_Hills.png" alt="Rain in the Hills" />
        <figcaption>Rain in the Hills</figcaption>
      </figure>
    </section>

    <!-- Debug console -->
    <h3 style="margin:26px 4px 10px">Debug Console</h3>
    <textarea id="uiDebug" class="transcribe-box" style="min-height:130px" readonly></textarea>
  </main>

  <!-- Fixed avatar/voice/pose (still overridable by backend env) -->
  <script>
    window.HEYGEN_FIXED = {
      avatar_id: "June_HR_public",
      voice_id:  "68dedac41a9f46a6a4271a95c733823c",
      pose_name: "June HR"
    };
  </script>

  <!-- Robust API base selection (Perfume2 backend) -->
  <script>
    (function(){
      const qsAPI = new URLSearchParams(location.search).get("api");
      const isLocal = location.protocol === "file:" ||
                      location.hostname === "localhost" ||
                      location.hostname.startsWith("127.");
      let base = qsAPI && qsAPI.trim();
      if (!base) {
        base = isLocal ? "http://localhost:8000" : "https://perfume2-backend.onrender.com";
      }
      window.API_BASE = base;
    })();
  </script>

  <script src="./perfume.js"></script>
</body>
</html>
